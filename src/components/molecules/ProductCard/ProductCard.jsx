import React from 'react';
import useLanguageStore from '../../../stores/languageStore';
import useGraniteSystemStore from '../../../stores/graniteSystemStore';
import { graniteTypes } from '../../../constants/graniteData';
import { surfaceFinishTypes, combinedFinishTypes } from '../../../constants/productsData';
import Button from '../../atoms/Button/Button';

const ProductCard = ({ product }) => {
  const { currentLanguage } = useLanguageStore();
  const { openGallery } = useGraniteSystemStore();

  // –û—Ç—Ä–∏–º—É—î–º–æ –¥–∞–Ω—ñ –ø—Ä–æ —Ç–µ–∫—Å—Ç—É—Ä—É –≥—Ä–∞–Ω—ñ—Ç—É
  const textureData = graniteTypes.find(granite => 
    granite.textures.some(texture => texture.id === product.textureId)
  );
  const texture = textureData?.textures.find(t => t.id === product.textureId);

  // –û—Ç—Ä–∏–º—É—î–º–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Ç–∏–ø –æ–±—Ä–æ–±–∫–∏
  const getFinishInfo = (finishType) => {
    return surfaceFinishTypes[finishType] || combinedFinishTypes[finishType];
  };

  const finishInfo = getFinishInfo(product.finishType);

  // –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è —Ä–æ–∑–º—ñ—Ä—ñ–≤
  const formatDimensions = (dimensions) => {
    if (dimensions.length === 'custom') {
      return currentLanguage === 'ua' ? '–ü—ñ–¥ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è' : 'Custom size';
    }
    // –†–æ–∑–º—ñ—Ä–∏ –≤–∂–µ –≤ –º–º
    return `${dimensions.length}√ó${dimensions.width}√ó${dimensions.height}–º–º`;
  };

  // –û–±—Ä–æ–±–∫–∞ –∫–ª—ñ–∫—É –Ω–∞ —Ç–µ–∫—Å—Ç—É—Ä—É
  const handleTextureClick = () => {
    if (textureData) {
      openGallery(textureData.id);
    }
  };

  // –û–±—Ä–æ–±–∫–∞ –∫–ª—ñ–∫—É –Ω–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
  const handleOrderClick = () => {
    // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –Ω–∞ Contact —Å—Ç–æ—Ä—ñ–Ω–∫—É
    window.location.href = '/eurogranite-website/contact';
  };

  return (
    <div className="product-card">
      {/* –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç—É */}
      <div className="product-image-container">
        <div className="product-image-wrapper">
          <picture>
            <source
              srcSet={product.image}
              type="image/webp"
              onError={(e) => {
                console.log('WebP failed to load:', product.image);
              }}
            />
            <img
              src={product.image.replace('.webp', '.jpg')}
              alt={product.name[currentLanguage]}
              className="product-image"
              onLoad={(e) => {
                console.log('Image loaded:', e.target.currentSrc || e.target.src);
              }}
              onError={(e) => {
                console.log('Image failed to load:', e.target.src);
                e.target.style.display = 'none';
                e.target.closest('.product-image-wrapper').querySelector('.product-image-placeholder').style.display = 'flex';
              }}
            />
          </picture>
          <div className="product-image-placeholder" style={{ display: 'none' }}>
            <div className="placeholder-icon">üì¶</div>
            <div className="placeholder-text">
              {product.name[currentLanguage]}
            </div>
          </div>
        </div>

        {/* –ë–µ–π–¥–∂ –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–æ—Å—Ç—ñ */}
        {product.isExclusive && (
          <div className="product-exclusive-badge">
            {currentLanguage === 'ua' ? '–ï–∫—Å–∫–ª—é–∑–∏–≤' : 'Exclusive'}
          </div>
        )}
      </div>

      {/* –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –ø—Ä–æ–¥—É–∫—Ç */}
      <div className="product-info">
        {/* –ù–∞–∑–≤–∞ –ø—Ä–æ–¥—É–∫—Ç—É */}
        <h3 className="product-name">
          {product.name[currentLanguage]}
        </h3>

        {/* –¢–µ–∫—Å—Ç—É—Ä–∞ —Ç–∞ –æ–±—Ä–æ–±–∫–∞ */}
        <div className="product-material-info">
          <button 
            className="texture-link"
            onClick={handleTextureClick}
            aria-label={`${currentLanguage === 'ua' ? '–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Ç–µ–∫—Å—Ç—É—Ä—É' : 'View texture'} ${texture?.name[currentLanguage]}`}
          >
            <span className="texture-name">
              {texture?.name[currentLanguage]}
            </span>
          </button>
          
          <div className="finish-info">
            <span className="finish-icon" aria-label={finishInfo?.name[currentLanguage]}>
              {finishInfo?.icon}
            </span>
            <span className="finish-name">
              {finishInfo?.name[currentLanguage]}
            </span>
          </div>
        </div>

        {/* –†–æ–∑–º—ñ—Ä–∏ */}
        <div className="product-dimensions">
          <span className="dimensions-label">
            {currentLanguage === 'ua' ? '–†–æ–∑–º—ñ—Ä–∏:' : 'Dimensions:'}
          </span>
          <span className="dimensions-value">
            {formatDimensions(product.dimensions)}
          </span>
        </div>

        {/* –¶—ñ–Ω–∞ */}
        <div className="product-pricing">
          <div className="price-main">
            {product.price[currentLanguage]}
          </div>
          {product.priceNote && (
            <div className="price-note">
              {product.priceNote[currentLanguage]}
            </div>
          )}
        </div>

        {/* –û–ø–∏—Å */}
        <p className="product-description">
          {product.description[currentLanguage]}
        </p>

        {/* –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ */}
        {product.features && (
          <div className="product-features">
            <h4 className="features-title">
              {currentLanguage === 'ua' ? '–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:' : 'Features:'}
            </h4>
            <ul className="features-list">
              {product.features[currentLanguage].map((feature, index) => (
                <li key={index} className="feature-item">
                  {feature}
                </li>
              ))}
            </ul>
          </div>
        )}

        {/* –ß–∞—Å –≤–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—è –¥–ª—è –∑–∞–º–æ–≤–ª–µ–Ω—å */}
        {!product.inStock && product.leadTime && (
          <div className="product-lead-time">
            <span className="lead-time-label">
              {currentLanguage === 'ua' ? '–ß–∞—Å –≤–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—è:' : 'Lead time:'}
            </span>
            <span className="lead-time-value">
              {product.leadTime[currentLanguage]}
            </span>
          </div>
        )}

        {/* –ö–Ω–æ–ø–∫–∏ –¥—ñ–π */}
        <div className="product-actions">
          <Button
            variant="primary"
            size="medium"
            onClick={handleOrderClick}
            className="order-button"
          >
            {currentLanguage === 'ua' ? '–ó–∞–º–æ–≤–∏—Ç–∏'
              : currentLanguage === 'en' ? 'Order Now'
              : currentLanguage === 'de' ? 'Bestellen'
              : 'Zam√≥w teraz'}
          </Button>
          
          <Button
            variant="outline"
            size="medium"
            onClick={handleTextureClick}
            className="texture-button"
          >
            {currentLanguage === 'ua' ? '–¢–µ–∫—Å—Ç—É—Ä–∏'
              : currentLanguage === 'en' ? 'View Textures'
              : currentLanguage === 'de' ? 'Texturen'
              : 'Tekstury'}
          </Button>
        </div>

        {/* –î–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∫–∞—Å—Ç–æ–º—ñ–∑–∞—Ü—ñ—é */}
        {product.customizable && (
          <div className="product-customization-note">
            <span className="customization-icon">‚öôÔ∏è</span>
            <span className="customization-text">
              {currentLanguage === 'ua' 
                ? '–ú–æ–∂–Ω–∞ –≤–∏–≥–æ—Ç–æ–≤–∏—Ç–∏ –∑ –±—É–¥—å-—è–∫–æ—ó —Ç–µ–∫—Å—Ç—É—Ä–∏' 
                : 'Can be made from any texture'
              }
            </span>
          </div>
        )}
      </div>
    </div>
  );
};

export default ProductCard;